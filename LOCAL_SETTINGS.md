# Система локальных визуальных настроек

## Обзор

Система локальных визуальных настроек позволяет пользователям настраивать внешний вид приложения без привязки к профилю пользователя. Все настройки сохраняются локально в браузере пользователя в `localStorage`.

## Возможности

### Поддерживаемые настройки

1. **Тема** - выбор между светлой, тёмной и системной темой
2. **Цветовая схема** - выбор основного цвета приложения (синий, зелёный, фиолетовый, оранжевый, красный)
3. **Размер шрифта** - настройка размера текста (маленький, средний, большой, очень большой)
4. **Упрощённые анимации** - отключение анимаций для пользователей с чувствительностью к движению
5. **Высокая контрастность** - улучшение читаемости для пользователей с нарушениями зрения

### Особенности

- **Мгновенное применение** - настройки применяются сразу после изменения
- **Автоматическое сохранение** - все изменения автоматически сохраняются в localStorage
- **Быстрый доступ** - переключатель темы доступен в хедере
- **Системная тема** - автоматическое следование настройкам системы
- **Отсутствие привязки к аккаунту** - настройки не зависят от профиля пользователя

## Архитектура

### Компоненты

1. **`useLocalSettings`** - основной хук для управления настройками
2. **`LocalSettingsProvider`** - провайдер контекста для глобального доступа к настройкам
3. **`ThemeToggle`** - компонент быстрого переключения темы
4. **Страница настроек** - полный интерфейс для настройки всех параметров

### Структура данных

```typescript
interface VisualSettings {
  theme: 'light' | 'dark' | 'system';
  colorScheme: string;
  fontSize: string;
  reduceMotion: boolean;
  contrastMode: 'normal' | 'high';
}
```

### Хранение

Настройки сохраняются в `localStorage` под ключом `"visualSettings"` в формате JSON.

## Использование

### В компонентах

```typescript
import { useLocalSettingsContext } from '@/components/providers/local-settings-provider';

function MyComponent() {
  const { settings, updateSetting } = useLocalSettingsContext();
  
  // Получить текущую тему
  const currentTheme = settings.theme;
  
  // Изменить тему
  const changeTheme = () => {
    updateSetting('theme', 'dark');
  };
  
  return (
    <div>
      <p>Текущая тема: {currentTheme}</p>
      <button onClick={changeTheme}>Переключить на тёмную</button>
    </div>
  );
}
```

### Быстрое переключение темы

Компонент `ThemeToggle` автоматически добавляется в хедер и позволяет быстро переключать между темами.

### Полная настройка

Для полной настройки всех параметров пользователь может перейти на страницу `/settings` в разделе "Внешний вид".

## Применение настроек

### При загрузке страницы

Настройки применяются в два этапа:

1. **До загрузки React** - скрипт в `index.html` применяет базовые настройки темы
2. **После загрузки React** - хук `useLocalSettings` применяет все настройки

### CSS классы

Система использует следующие CSS классы:

- `dark` - для тёмной темы
- `motion-reduce` - для отключения анимаций
- `high-contrast` - для высокой контрастности
- `text-sm`, `text-base`, `text-lg`, `text-xl` - для размеров шрифта

### CSS переменные

Цветовые схемы применяются через CSS переменные:

```css
:root {
  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;
}
```

## Миграция

### С серверных настроек

Если ранее настройки хранились на сервере, система автоматически переключится на локальное хранение. Старые серверные настройки больше не используются.

### Очистка данных

Для сброса настроек пользователь может:

1. Очистить localStorage в браузере
2. Использовать кнопку "Сбросить настройки" на странице настроек (если реализована)

## Безопасность

- Настройки хранятся только локально в браузере
- Данные не передаются на сервер
- Нет риска утечки персональных данных
- Работает без интернета после первой загрузки

## Производительность

- Минимальное влияние на производительность
- Настройки загружаются один раз при инициализации
- Изменения применяются мгновенно без перезагрузки страницы
- Оптимизированное применение CSS классов

## Совместимость

- Работает во всех современных браузерах
- Поддерживает `localStorage`
- Совместимо с системными настройками темы
- Адаптивно к изменениям системной темы в реальном времени 